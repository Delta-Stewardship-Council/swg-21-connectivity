---
title: "Connectivity model summary statistics - raw data"
author: "Liz Stumpner"
date: "2023-06-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, fig.width=15, fig.height=15)
```

```{r}
library(readr)
library(dplyr)
library(stringr)
library(flextable)
library(lubridate)
library(ggplot2)
library(ggpubr)
library(tidyverse)
library(broom)
```
The RMD is used to summarize the raw data used in the Connectivity GAM model. The results of the output table are used in the body of the methods text

```{r}

new <- read_csv("C:/Users/estumpne/Documents/R/swg-21-connectivity/data_publication/data_clean/model_chla_covars.csv")

#summary stats

dryPd <- new %>%
  filter(inundation == 0) #filtdata 520

wetPd <- new %>%
  filter(inundation == 1) #filtdata 144

#519+143 = 662

data_tbl <- new %>%
  select(chlorophyll, WTmwk, Q_sday, region, water_year, inundation, inund_factor)

data_tbl <- unique(data_tbl)

#summarize by inundation factor (none, short, long) and region

data_tbl <- data_tbl %>%
  group_by(region, inundation, inund_factor) %>%
  summarize(min_chla = min(chlorophyll),
            max_chla = max(chlorophyll),
            mean_chla = mean(chlorophyll),
            r_chla = max_chla-min_chla,
            sd_chla = sd(chlorophyll),
            min_WTmwk = min(WTmwk),
            max_WTmwk = max(WTmwk),
            mean_WTmwk = mean(WTmwk),
            r_WTmwk = max_WTmwk - min_WTmwk,
            sd_WTmwk = sd(WTmwk),
            min_Q_sday = min(Q_sday),
            max_Q_sday = max(Q_sday),
            mean_Q_sday = mean(Q_sday),
            sd_Q_sday = sd(Q_sday),
            n = n())

#round values
data_tbl$min_chla <- round(data_tbl$min_chla, 1)
data_tbl$max_chla <- round(data_tbl$max_chla, 1)
data_tbl$mean_chla <- round(data_tbl$mean_chla, 1)
data_tbl$r_chla <- round(data_tbl$r_chla, 1)
data_tbl$sd_chla <- round(data_tbl$sd_chla, 1)
data_tbl$min_WTmwk <- round(data_tbl$min_WTmwk, 1)
data_tbl$max_WTmwk <- round(data_tbl$max_WTmwk, 1)
data_tbl$mean_WTmwk <- round(data_tbl$mean_WTmwk, 1)
data_tbl$r_WTmwk <- round(data_tbl$r_WTmwk, 1)
data_tbl$sd_WTmwk <- round(data_tbl$sd_WTmwk, 1)
data_tbl$min_Q_sday <- round(data_tbl$min_Q_sday, 0)
data_tbl$max_Q_sday <- round(data_tbl$max_Q_sday, 0)
data_tbl$mean_Q_sday <- round(data_tbl$mean_Q_sday, 0)
data_tbl$sd_Q_sday <- round(data_tbl$sd_Q_sday, 0)


data_tbl <- data_tbl %>% 
  rename('inun' = 'inundation')

#view and save table by inundation factor (none, short, long) and region 

flextable(data_tbl)

write_csv(data_tbl, "C:/Users/estumpne/Documents/R/swg-21-connectivity/data_publication/R/raw_data_summary_region_inunfac.csv")

#summarize by region 

data_tbl2 <- new %>%
  select(chlorophyll, WTmwk, Q_sday, region, water_year)

data_tbl2 <- unique(data_tbl2)

data_tbl2 <- data_tbl2 %>%
  group_by(region) %>%
  summarize(min_chla = min(chlorophyll),
            max_chla = max(chlorophyll),
            mean_chla = mean(chlorophyll),
            r_chla = max_chla-min_chla,
            sd_chla = sd(chlorophyll),
            min_WTmwk = min(WTmwk),
            max_WTmwk = max(WTmwk),
            mean_WTmwk = mean(WTmwk),
            r_WTmwk = max_WTmwk - min_WTmwk,
            sd_WTmwk = sd(WTmwk),
            min_Q_sday = min(Q_sday),
            max_Q_sday = max(Q_sday),
            mean_Q_sday = mean(Q_sday),
            sd_Q_sday = sd(Q_sday),
            n = n())

#round values
data_tbl2$min_chla <- round(data_tbl2$min_chla, 1)
data_tbl2$max_chla <- round(data_tbl2$max_chla, 1)
data_tbl2$mean_chla <- round(data_tbl2$mean_chla, 1)
data_tbl2$r_chla <- round(data_tbl2$r_chla, 1)
data_tbl2$sd_chla <- round(data_tbl2$sd_chla, 1)
data_tbl2$min_WTmwk <- round(data_tbl2$min_WTmwk, 1)
data_tbl2$max_WTmwk <- round(data_tbl2$max_WTmwk, 1)
data_tbl2$mean_WTmwk <- round(data_tbl2$mean_WTmwk, 1)
data_tbl2$r_WTmwk <- round(data_tbl2$r_WTmwk, 1)
data_tbl2$sd_WTmwk <- round(data_tbl2$sd_WTmwk, 1)
data_tbl2$min_Q_sday <- round(data_tbl2$min_Q_sday, 0)
data_tbl2$max_Q_sday <- round(data_tbl2$max_Q_sday, 0)
data_tbl2$mean_Q_sday <- round(data_tbl2$mean_Q_sday, 0)
data_tbl2$sd_Q_sday <- round(data_tbl2$sd_Q_sday, 0)


#view and save table by region 

flextable(data_tbl2)

write_csv(data_tbl2, "C:/Users/estumpne/Documents/R/swg-21-connectivity/data_publication/R/raw_data_summary_region.csv")

#summarize by inundation (Y/N) and region

data_tbl3 <- new %>%
  select(chlorophyll, WTmwk, Q_sday, inundation, water_year)

data_tbl3 <- unique(data_tbl3)

data_tbl3 <- data_tbl3 %>%
  group_by(inundation) %>%
  summarize(min_chla = min(chlorophyll),
            max_chla = max(chlorophyll),
            mean_chla = mean(chlorophyll),
            r_chla = max_chla-min_chla,
            sd_chla = sd(chlorophyll),
            min_WTmwk = min(WTmwk),
            max_WTmwk = max(WTmwk),
            mean_WTmwk = mean(WTmwk),
            r_WTmwk = max_WTmwk - min_WTmwk,
            sd_WTmwk = sd(WTmwk),
            min_Q_sday = min(Q_sday),
            max_Q_sday = max(Q_sday),
            mean_Q_sday = mean(Q_sday),
            sd_Q_sday = sd(Q_sday),
            n = n())

#round values
data_tbl3$min_chla <- round(data_tbl3$min_chla, 1)
data_tbl3$max_chla <- round(data_tbl3$max_chla, 1)
data_tbl3$mean_chla <- round(data_tbl3$mean_chla, 1)
data_tbl3$r_chla <- round(data_tbl3$r_chla, 1)
data_tbl3$sd_chla <- round(data_tbl3$sd_chla, 1)
data_tbl3$min_WTmwk <- round(data_tbl3$min_WTmwk, 1)
data_tbl3$max_WTmwk <- round(data_tbl3$max_WTmwk, 1)
data_tbl3$mean_WTmwk <- round(data_tbl3$mean_WTmwk, 1)
data_tbl3$r_WTmwk <- round(data_tbl3$r_WTmwk, 1)
data_tbl3$sd_WTmwk <- round(data_tbl3$sd_WTmwk, 1)
data_tbl3$min_Q_sday <- round(data_tbl3$min_Q_sday, 0)
data_tbl3$max_Q_sday <- round(data_tbl3$max_Q_sday, 0)
data_tbl3$mean_Q_sday <- round(data_tbl3$mean_Q_sday, 0)
data_tbl3$sd_Q_sday <- round(data_tbl3$sd_Q_sday, 0)

#view and save table by inundation (Y/N) and region

flextable(data_tbl3)

write_csv(data_tbl3, "C:/Users/estumpne/Documents/R/swg-21-connectivity/data_publication/R/raw_data_summary_inun.csv")


```


